import json
from pathlib import Path

src = Path("C:/giwanos/data/judgments/judgment_history_index.json")
dst = Path("C:/giwanos/interface/judgment_dashboard/data/judgment_history_index.json")

# 기존 구조 로드
with src.open("r", encoding="utf-8") as f:
    old = json.load(f).get("judgment_index", [])

# 고도화 변환
new = []
for entry in old:
    new.append({
        "id": Path(entry["file"]).stem.replace("judgment_", ""),
        "timestamp": entry["timestamp"],
        "user_request": entry["user_request"],
        "explanation": entry["explanation"],
        "risk_level": entry["risk_level"],
        "tags": entry.get("tags", []),
        "related_memory_keys": [],  # 추후 연결될 수 있음
        "file": Path(entry["file"]).name
    })

# 저장
dst.parent.mkdir(parents=True, exist_ok=True)
with dst.open("w", encoding="utf-8") as f:
    json.dump(new, f, indent=2, ensure_ascii=False)

print("✅ 변환 완료:", dst)
